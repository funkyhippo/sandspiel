(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1:function(e,t,n){"use strict";n.r(t),n.d(t,"canvas",(function(){return ot})),n.d(t,"width",(function(){return at})),n.d(t,"height",(function(){return it})),n.d(t,"universe",(function(){return rt})),n.d(t,"reset",(function(){return ft}));var r=n(36),a=n.n(r),i=n(37),o=n.n(i),s=n(8);function u(e){return new Promise((function(t){return setTimeout(t,e)}))}function c(){return(c=a()(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fetch("https://i.imgur.com/jzwSmsC.png").then((function(e){return e.blob()})).then((function(e){var r=URL.createObjectURL(e),a=new Image;a.src=r,a.onload=function(){var e=document.createElement("canvas");e.width=t,e.height=n;var r=e.getContext("2d");r.translate(e.width/2,e.height/2),r.rotate(-90*Math.PI/180),r.scale(-1,1),r.translate(-e.width/2,-e.height/2),r.drawImage(a,0,0);var i=r.getImageData(0,0,e.width,e.height),o=new Uint8Array(s.d.buffer,window.u.cells(),t*n*4);window.stopboot=!0;for(var u=0;u<t*n*4;u++)o[u]=i.data[u];window.u.flush_undos(),window.u.push_undo(),window.paused=!1}})),e.next=3,u(80);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var l=n(23),d=n(24),f=n.n(d),m=n(43),v=n(44),p=n(45),h=function(e){var t=e.canvas,n=e.universe,r=e.isSnapshot,a=void 0!==r&&r,i=m({canvas:t,attributes:{preserveDrawingBuffer:a}}),o=n.width(),u=n.height(),c=n.cells(),l=new Uint8Array(s.d.buffer,c,o*u*4),d=i.texture({width:o,height:u,data:l}),f=i({frag:v,uniforms:{t:function(e){return e.tick},data:function(){return c=n.cells(),l=new Uint8Array(s.d.buffer,c,o*u*4),d({width:o,height:u,data:l})},resolution:function(e){return[e.viewportWidth,e.viewportHeight]},dpi:2*window.devicePixelRatio,isSnapshot:a},vert:p,attributes:{position:[[-1,4],[-1,-1],[4,-1]]},count:3});return function(){i.poll(),f()}},g=n(5),E=n.n(g),y=n(6),x=n.n(y),b=new(function(){function e(){E()(this,e),this.fps=document.getElementById("fps"),this.frames=[],this.lastFrameTimeStamp=performance.now()}return x()(e,[{key:"render",value:function(){var e=performance.now(),t=e-this.lastFrameTimeStamp;this.lastFrameTimeStamp=e;var n=1/t*1e3;this.frames.push(n),this.frames.length>30&&this.frames.shift();for(var r=1/0,a=-1/0,i=0,o=0;o<this.frames.length;o++)i+=this.frames[o],r=Math.min(this.frames[o],r),a=Math.max(this.frames[o],a);var s=i/this.frames.length;this.fps.textContent="FPS:".concat(Math.round(s))}}]),e}()),w=n(9),T=n.n(w),R=n(13),_=n.n(R),S=n(10),D=n.n(S),U=n(11),A=n.n(U),I=n(12),k=n.n(I),F=n(3),L=n.n(F),C=n(4),P=n(28);n(29),n(92),n(93);window.firebase=P.a,P.a.initializeApp({apiKey:"AIzaSyD2APPEyxCi9vB2olvUgzSsbgH1Pyz-as0",storageBucket:"sandtable-8d0f7.appspot.com",authDomain:"sandspiel.club",projectId:"sandtable-8d0f7",appId:"1:239719651525:web:80d3674408670521",messagingSenderId:"239719651525"});var O=P.a.storage(),B=P.a.functions(),N=n(30),X=n.n(N);function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k()(e);if(t){var a=k()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return A()(this,n)}}L.a.Component;var z=n(31),j=n.n(z),G=function(e){var t=e.close,n=e.children;return j.a.createPortal(L.a.createElement("div",{className:"menu-scrim"},L.a.createElement("div",{className:"menu"},n,L.a.createElement(C.b,{to:"/",className:"x",onClick:t},L.a.createElement("button",null," x")))),document.getElementById("container"))};function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){T()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k()(e);if(t){var a=k()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return A()(this,n)}}window.species=l.a;var H=function(){var e=document.createElement("canvas"),t=Object.values(l.a).filter((function(e){return Number.isInteger(e)})),n=Math.max.apply(Math,f()(t))+1,r=l.b.new(n,1);e.width=3,e.height=n,r.reset(),t.forEach((function(e){return r.paint(e,0,1,e)})),h({universe:r,canvas:e,isSnapshot:!0})();var a=e.getContext("webgl"),i=new Uint8Array(4*n);a.readPixels(0,0,1,n,a.RGBA,a.UNSIGNED_BYTE,i);var o={};return t.forEach((function(e){var t=4*(n-1-e),r="rgba(".concat(i[t],",").concat(i[t+1],", ").concat(i[t+2],", 0.25)");o[e]=r})),o}(),q=[1,3,7,19,39],K=function(e){D()(n,e);var t=Y(n);function n(e){var r;return E()(this,n),(r=t.call(this,e)).state={submissionMenuOpen:!1,paused:!1,submitting:!1,size:2,dataURL:{},currentSubmission:null,selectedElement:l.a.Water},window.UI=_()(r),"/"!==r.props.location.pathname&&"/school"!==r.props.location.pathname&&window.setTimeout((function(){return r.pause()}),50),r.load(),r}return x()(n,[{key:"componentDidUpdate",value:function(e){"/"===this.props.location.pathname&&"/"!==e.location.pathname&&this.state.currentSubmission?window.location="#".concat(this.state.currentSubmission.id):("/"!==this.props.location.pathname&&"/"==e.location.pathname&&this.pause(),""!==e.location.hash&&e.location.hash==this.props.location.hash||this.load())}},{key:"togglePause",value:function(){window.paused=!this.state.paused,this.setState({paused:!this.state.paused})}},{key:"play",value:function(){window.paused=!1,this.setState({paused:!1})}},{key:"pause",value:function(){window.paused=!0,this.setState({paused:!0})}},{key:"setSize",value:function(e,t){e.preventDefault(),this.setState({size:t})}},{key:"reset",value:function(){window.confirm("Reset?")&&(this.play(),window.location="#",this.setState({currentSubmission:null}),ft())}},{key:"menu",value:function(){this.pause(),this.setState({submissionMenuOpen:!0})}},{key:"closeMenu",value:function(){this.play(),this.setState({submissionMenuOpen:!1})}},{key:"upload",value:function(){var e=function(e){var t=document.createElement("canvas");return t.width=e.width()/2,t.height=e.height()/2,h({universe:e,canvas:t,isSnapshot:!0})(),t.toDataURL("image/png")}(rt),t=new Uint8Array(s.d.buffer,rt.cells(),at*it*4),n=document.createElement("canvas"),r=n.getContext("2d"),a=r.createImageData(at,it);n.height=it,n.width=at;for(var i=0;i<at;i++)for(var o=0;o<it;o++)for(var u=4*(o+i*it),c=4*(i+o*at),l=0;l<4;l++)a.data[c+l]=l%4==3?255:t[u+l];r.putImageData(a,0,0);var d=n.toDataURL("image/png");this.pause(),this.setState({data:{dataURL:e,cells:d},submissionMenuOpen:!0})}},{key:"rateLimited",value:function(){var e=JSON.parse(localStorage.getItem("postList")||"[]");return(e=e.filter((function(e){return Date.now()-3e5<e}))).length>=3&&(Sentry.captureMessage("RATELIMIT"),!0)}},{key:"submit",value:function(){var e,t=this,n=this.state,r=n.title,a=n.data,i=n.currentSubmission,o=a.dataURL,s=a.cells,u=firebase.auth().currentUser,c={title:r=r.replace("[profile]","https://sandspiel.club/browse/search/?user=".concat(u.uid)),image:o,parent_id:null==i||null===(e=i.data)||void 0===e?void 0:e.id,cells:s},l=JSON.parse(localStorage.getItem("postList")||"[]");(l=l.filter((function(e){return Date.now()-18e4<e}))).push(Date.now()),localStorage.setItem("postList",JSON.stringify(l)),this.setState({submitting:!0}),u.getIdToken().then((function(e){fetch(B._url("api/creations"),{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}}).then((function(e){return e.json()})).then((function(e){console.log("Success:",JSON.stringify(e)),t.play()})).catch((function(e){return console.error("Error:",e)})).then((function(){t.setState({submissionMenuOpen:!1,submitting:!1})}))}))}},{key:"load",value:function(){var e=this,t=this.props.location.hash.replace(/#/,"");""!==t&&(this.state.currentSubmission&&this.state.currentSubmission.id==t||fetch(B._url("api/creations/".concat(t)),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(n){O.refFromURL("gs://sandtable-8d0f7.appspot.com/creations/".concat(n.id,".data.png")).getDownloadURL().then((function(r){fetch(r,{method:"GET"}).then((function(e){return e.blob()})).then((function(r){e.setState({currentSubmission:{id:t,data:n}});var a=URL.createObjectURL(r),i=new Image;i.src=a,i.onload=function(){var t=document.createElement("canvas");t.width=at,t.height=it;var n=t.getContext("2d");n.translate(t.width/2,t.height/2),n.rotate(-90*Math.PI/180),n.scale(-1,1),n.translate(-t.width/2,-t.height/2),n.drawImage(i,0,0);var r=n.getImageData(0,0,t.width,t.height),a=new Uint8Array(s.d.buffer,rt.cells(),at*it*4);ft(),window.stopboot=!0;for(var o=0;o<at*it*4;o++)a[o]=r.data[o];rt.flush_undos(),rt.push_undo(),e.pause()}})).catch((function(e){return console.error("Error:",e)}))}))})).catch((function(e){console.error("Error:",e)})))}},{key:"incScore",value:function(){var e=this,t=this.state.currentSubmission,n=t.id;firebase.auth().currentUser.getIdToken().then((function(r){fetch(B._url("api/creations/".concat(n,"/vote")),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){return e.json()})).then((function(n){null!=t&&e.setState({currentSubmission:W(W({},t),{},{data:n})})})).catch((function(e){console.error(e)}))}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.size,r=t.paused,a=t.selectedElement,i=t.currentSubmission,o=i&&i.id?"#".concat(i.id):"";return L.a.createElement(L.a.Fragment,null,L.a.createElement("button",{onClick:function(){return e.togglePause()},className:r?"selected":""},r?L.a.createElement("svg",{height:"20",width:"20",id:"d",viewBox:"0 0 300 300"},L.a.createElement("polygon",{id:"play",points:"0,0 , 300,150 0,300"})):L.a.createElement("svg",{height:"20",width:"20",id:"d",viewBox:"0 0 300 300"},L.a.createElement("polygon",{id:"bar2",points:"0,0 110,0 110,300 0,300"}),L.a.createElement("polygon",{id:"bar1",points:"190,0 300,0 300,300 190,300"}))),L.a.createElement("button",{onClick:function(){return e.reset()}},"Reset"),L.a.createElement(C.b,{to:{pathname:"/info/",hash:o}},L.a.createElement("button",null,"Info")),L.a.createElement("span",{className:"sizes"},q.map((function(t,r){return L.a.createElement("button",{key:r,className:r==n?"selected":"",onClick:function(t){return e.setSize(t,r)},style:{padding:"0px"}},L.a.createElement("svg",{height:"23",width:"23",id:"d",viewBox:"0 0 100 100"},L.a.createElement("circle",{cx:"50",cy:"50",r:3+t})))}))),L.a.createElement("button",{onClick:function(){ft(),rt.pop_undo()},style:{fontSize:35}},"â†œ"),L.a.createElement("button",{className:-1==a?"selected":"",key:name,onClick:function(){e.setState({selectedElement:-1})}},"Wind"),Object.keys(l.a).filter((function(e){return!Number.isInteger(Number.parseInt(e))})).map((function(t){return function(e,t,n){var r=l.a[e],a=H[r],i=r==t,o="inherit";return 14==r&&(o="linear-gradient(45deg, \n    rgba(202, 121, 125, 0.25), \n    rgba(169, 120, 200, 0.25), \n    rgba(117, 118, 195, 0.25), \n    rgba(117, 196, 193, 0.25), \n    rgba(122, 203, 168, 0.25), \n    rgba(185, 195, 117, 0.25), \n    rgba(204, 186, 122, 0.25))",i&&(o=o.replace(/0.25/g,"1.0"))),L.a.createElement("button",{className:i?"selected":"",key:e,onClick:function(){n(r)},style:{background:o,backgroundColor:i?a.replace("0.25","1.5"):a}},"  ",e,"  ")}(t,a,(function(t){return e.setState({selectedElement:t})}))})))}}]),n}(L.a.Component),J=document.getElementById("sand-canvas"),Q=function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2),2)},Z=function(e){var t=function(e){return Math.sqrt(Math.pow(e.clientX,2)+Math.pow(e.clientY,2),2)}(e);return{clientX:e.clientX/t,clientY:e.clientY/t}},$=function(e,t){return{clientX:e.clientX*t,clientY:e.clientY*t}},ee=function(e,t){return{clientX:e.clientX+t.clientX,clientY:e.clientY+t.clientY}},te=!1,ne=null,re=null;function ae(e){clearInterval(re),re=window.setInterval((function(){return oe(e)}),100);var t={clientX:e.clientX,clientY:e.clientY};if(te){var n,r,a=q[window.UI.state.size],i=0;if(oe(t),ne)for(;Q(t,ne)>a/3;){var o=Q(t,ne);if(t=ee(t,$(Z((r=e,{clientX:(n=ne).clientX-r.clientX,clientY:n.clientY-r.clientY})),Math.min(a/3,o))),++i>1e3)break;oe(t)}ne=e}}J.addEventListener("mousedown",(function(e){e.preventDefault(),rt.push_undo(),te=!0,clearInterval(re),re=window.setInterval((function(){return oe(e)}),100),oe(e),ne=e})),document.body.addEventListener("mouseup",(function(e){clearInterval(re),te&&(e.preventDefault(),ne=null,te=!1)})),J.addEventListener("mousemove",(function(e){clearInterval(re),ae(e)})),J.addEventListener("mouseleave",(function(e){clearInterval(re),ne=null})),J.addEventListener("touchstart",(function(e){rt.push_undo(),e.cancelable&&e.preventDefault(),te=!0,ne=e,ie(e)})),J.addEventListener("touchend",(function(e){e.cancelable&&e.preventDefault(),ne=null,te=!1,clearInterval(re)})),J.addEventListener("touchmove",(function(e){window.paused||e.cancelable&&e.preventDefault(),clearInterval(re),ie(e)}));var ie=function(e){var t=Array.from(e.touches);1==t.length?ae(t[0]):t.forEach(oe)},oe=function(e){if(te){var t=J.getBoundingClientRect(),n=J.width/Math.ceil(window.devicePixelRatio)/t.width,r=J.height/Math.ceil(window.devicePixelRatio)/t.height,a=(e.clientX-t.left)*n,i=(e.clientY-t.top)*r,o=Math.min(Math.floor(a),at-1),s=Math.min(Math.floor(i),it-1);window.UI.state.selectedElement<0||rt.paint(o,s,q[window.UI.state.size],window.UI.state.selectedElement)}},se=n(2),ue=function(){return L.a.createElement("div",{className:"Info"},L.a.createElement("h1",null,"Sandspiel "),L.a.createElement("br",null),L.a.createElement("p",null,"Created by ",L.a.createElement("a",{href:"https://maxbittker.com"},"max bittker"),", modified by funkyhippo"),L.a.createElement("br",null),L.a.createElement("p",null,"Make sure you play the original"," ",L.a.createElement("a",{href:"https://sandspiel.club/"},"here"),"!"),L.a.createElement("br",null),L.a.createElement("hr",null),L.a.createElement("h2",null,"Element Information:"),L.a.createElement("h4",null,"Wall "),"Indestructible",L.a.createElement("h4",null,"Sand "),"Sinks in water",L.a.createElement("h4",null,"Water "),"Puts out fire",L.a.createElement("h4",null,"Stone "),"Forms arches, folds under pressure",L.a.createElement("h4",null,"Ice "),"Freezes Water, slippery!",L.a.createElement("h4",null,"Gas "),"Highly Flammable!",L.a.createElement("h4",null,"Cloner "),"Copies the first element it touches",L.a.createElement("h4",null,"Mite "),"Eats wood and plant, but loves dust! Slides on ice",L.a.createElement("h4",null,"Wood "),"Sturdy, but biodegradable",L.a.createElement("h4",null,"Plant "),"Thrives in wet enviroments",L.a.createElement("h4",null,"Fungus "),"Spreads over everything",L.a.createElement("h4",null,"Seed "),"Grows in sand",L.a.createElement("h4",null,"Fire "),"Hot!",L.a.createElement("h4",null,"Lava "),"Flammable and heavy",L.a.createElement("h4",null,"Acid "),"Corrodes other elements",L.a.createElement("h4",null,"Dust "),"Pretty, but dangerously explosive",L.a.createElement("h4",null,"Oil "),"Produces smoke",L.a.createElement("h4",null,"Rocket "),"Explodes into copies of the first element it touches",L.a.createElement("hr",null),L.a.createElement("hr",null),L.a.createElement("hr",null),L.a.createElement("hr",null))},ce=n(34),le=n.n(ce);function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k()(e);if(t){var a=k()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return A()(this,n)}}var fe=function(e){D()(n,e);var t=de(n);function n(){var e;E()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),T()(_()(e),"state",{isSignedIn:!1,expanded:!0}),T()(_()(e),"uiConfig",{signInFlow:"redirect",signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,signInMethod:firebase.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD,emailLinkSignIn:function(){return{url:"https://sandspiel.club/browse",handleCodeInApp:!0}}}],callbacks:{signInSuccessWithAuthResult:function(){return!1}}}),e}return x()(n,[{key:"componentDidMount",value:function(){var e=this;this.setState({isSignedIn:!!firebase.auth().currentUser}),this.unregisterAuthObserver=firebase.auth().onAuthStateChanged((function(t){return e.setState({isSignedIn:!!t})}))}},{key:"componentWillUnmount",value:function(){this.unregisterAuthObserver()}},{key:"render",value:function(){var e=this;if(!this.state.isSignedIn)return this.state.expanded?L.a.createElement(L.a.Fragment,null,"Sign-in to post and to vote!",L.a.createElement(X.a,{uiConfig:this.uiConfig,firebaseAuth:firebase.auth()})):L.a.createElement("span",null,L.a.createElement("p",null,"Please"," ",L.a.createElement("button",{onClick:function(){return e.setState({expanded:!0})}},"Sign in")," ","to vote!"," "),L.a.createElement("span",{style:{display:"none"}},L.a.createElement(X.a,{uiConfig:this.uiConfig,FirebaseAuth:firebase.auth()})));var t=firebase.auth().currentUser;return L.a.createElement("div",null,L.a.createElement("div",{style:{display:"flex",alignItems:"center"}},L.a.createElement(C.c,{style:{flexGrow:0,margin:"0 4px",fontSize:"19px"},to:{pathname:"/browse/search/",search:"?user=".concat(t.uid)}},"[Post History]"),!t.emailVerified&&"Please Verify your email ".concat(t.email," to vote!"),L.a.createElement("button",{style:{flexGrow:0,margin:"0 10px"},onClick:function(){window.confirm("sign out?")&&firebase.auth().signOut()}},"Sign-out")))}}]),n}(L.a.Component),me=n(74),ve=n.n(me),pe=function(e){var t=e.text.split(" ").map((function(e,t){return e.startsWith("#")&&e.length>1?L.a.createElement(L.a.Fragment,{key:t},L.a.createElement(C.b,{to:{pathname:"/browse/search/",search:"?title=".concat(e.slice(1))}},e)," "):e.startsWith("https://sandspiel.club/browse/search/?user=")?L.a.createElement(L.a.Fragment,{key:t},L.a.createElement(C.b,{to:{pathname:"/browse/search/",search:e.slice("https://sandspiel.club/browse/search/".length)}},"[profile]")," "):e+" "}));return L.a.createElement(L.a.Fragment,null,t)},he=n(78),ge=n.n(he);function Ee(e){var t,n=e.submission,r=e.voteFromBrowse,a=e.browseVotes,i=e.report,o=e.redundent_parent_id,s=e.redundent_child_id,u=Object(F.useState)(null),c=ve()(u,2),l=c[0],d=c[1],f=Object(F.useState)(null),m=ve()(f,2),v=m[0],p=m[1],h=new Date(n.data.timestamp).toLocaleDateString();(new Date).getTime()-new Date(n.data.timestamp).getTime()<864e5&&(h=we.format(n.data.timestamp));var g=null===(t=n.data)||void 0===t?void 0:t.parent_id;return L.a.createElement("div",{className:"thread"},l&&L.a.createElement(Ee,{submission:l,voteFromBrowse:r,browseVotes:a,report:i,redundent_child_id:n.id}),L.a.createElement("div",{key:n.id,className:ge()("submission",{expandedTop:l,expandedBottom:v})},L.a.createElement(C.b,{className:"img-link",to:{pathname:"/",hash:"#".concat(n.id.slice(0,20))},onClick:function(){window.UI.setState((function(){return{currentSubmission:null}}),window.UI.load)}},L.a.createElement("img",{src:"".concat(Te).concat(n.data.id,".png?alt=media")})),L.a.createElement("div",{style:{width:"50%"}},g&&!o&&L.a.createElement("button",{title:"parent post",className:ge()("parent",{active:l}),onClick:function(){fetch(B._url("api/creations/".concat(n.data.parent_id.slice(0,20))),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){d({id:e.id,data:e})}))}},"â†‘"),L.a.createElement("h3",{style:{flexGrow:1,wordWrap:"break-word",fontSize:n.data.title.length>100?" 0.9em":"1.1em"}},g&&L.a.createElement("span",{className:"blocker"}),L.a.createElement(pe,{text:n.data.title})),L.a.createElement("span",{className:"bottom-row"},L.a.createElement("span",null,h," "),L.a.createElement("button",{className:"heart",onClick:function(){return r(n)}},a[n.id]||n.data.score,a[n.id]?"ðŸ–¤":"â™¡")),L.a.createElement("button",{className:"report",title:"report",onClick:function(){return i(n.id)}},"!"),n.data.children>(s?1:0)&&L.a.createElement("button",{className:ge()("children",{active:v}),title:"show children",onClick:function(){fetch(B._url("api/creations?parent=".concat(n.data.id)),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){p(e.filter((function(e){return e.id!==s})))}))}},n.data.children,"â†“"))),v&&v.map((function(e){return L.a.createElement(Ee,{key:e.id,submission:e,voteFromBrowse:r,browseVotes:a,report:i,redundent_parent_id:n.id})})))}function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){T()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k()(e);if(t){var a=k()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return A()(this,n)}}var we=le()(),Te="https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F",Re=function(e){D()(n,e);var t=be(n);function n(){return E()(this,n),t.apply(this,arguments)}return x()(n,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.submissions,r=t.browseVotes;return e.submissions!==n||Object.keys(e.browseVotes).length!==Object.keys(r).length}},{key:"render",value:function(){var e=this.props,t=e.submissions,n=e.voteFromBrowse,r=e.browseVotes,a=e.report;return t?0==t.length?L.a.createElement("div",{style:{height:"90vh"}},"Didn't find anything!"):L.a.createElement("div",{className:"submissions"},t.map((function(e){return L.a.createElement(Ee,{key:e.id,submission:e,voteFromBrowse:n,browseVotes:r,report:a})}))):L.a.createElement("div",{style:{height:"90vh"}},"Loading Submissions...")}}]),n}(L.a.Component),_e=function(e){D()(n,e);var t=be(n);function n(e){var r;return E()(this,n),(r=t.call(this,e)).state={paused:!1,submitting:!1,dataURL:{},submissions:null,browseVotes:{},search:""},r}return x()(n,[{key:"componentWillMount",value:function(){this.loadSubmissions()}},{key:"componentDidUpdate",value:function(e){e.location.pathname==this.props.location.pathname&&e.location.search==this.props.location.search||this.loadSubmissions()}},{key:"togglePause",value:function(){window.paused=!this.state.paused,this.setState({paused:!this.state.paused})}},{key:"setSize",value:function(e,t){e.preventDefault(),this.setState({size:t})}},{key:"loadSubmissions",value:function(){var e=this,t=this.props.location;t.search.startsWith("?title=")&&this.setState({search:this.props.location.search.slice(7)});var n="";t.pathname.startsWith("/browse/top/")&&(n="?q=score"),t.pathname.startsWith("/browse/top/day")&&(n="?q=score&d=1"),t.pathname.startsWith("/browse/top/week")&&(n="?q=score&d=7"),t.pathname.startsWith("/browse/top/month")&&(n="?q=score&d=30"),t.pathname.startsWith("/browse/search/")&&(n=t.search,t.user&&(n=t.user)),this.setState({submissions:null}),fetch(B._url("api/creations")+n,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){e.setState({submissions:t})})).catch((function(t){e.setState({submissions:!1}),console.error("Error:",t)}))}},{key:"voteFromBrowse",value:function(e){var t=this;this.setState((function(t){var n=t.browseVotes;return{browseVotes:xe(T()({},e.id,e.data.score+1),n)}})),firebase.auth().currentUser.getIdToken().then((function(n){fetch(B._url("api/creations/".concat(e.id,"/vote")),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){return e.json()})).then((function(n){t.setState((function(t){var r=t.browseVotes;return{browseVotes:xe(T()({},e.id,n.score),r)}}))})).catch((function(e){console.error(e)}))}))}},{key:"report",value:function(e){firebase.auth().currentUser.getIdToken().then((function(t){fetch(B._url("api/creations/".concat(e,"/report")),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}}).then((function(e){return e.json()})).then((function(e){})).catch((function(e){console.error(e)}))}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.search,r=t.submissions,a=t.browseVotes;return L.a.createElement(L.a.Fragment,null,L.a.createElement(fe,null),L.a.createElement("p",{style:{gridColumn:"auto / span 2",margin:"8px",fontSize:16}},"Check out â˜ž ",L.a.createElement("br",null),L.a.createElement("a",{href:"https://www.youtube.com/watch?v=BDyvjkAs5-Y",target:"_blank"}," ",'"Top 9 ways to make Sand" [Luke Wilson]'),L.a.createElement("br",null),L.a.createElement("a",{href:"https://www.youtube.com/watch?v=ui1Rvfi25Wc&feature=youtu.be",target:"_blank"}," ",'"Lucky Frog - Silence" [Music Video]')),L.a.createElement(C.c,{exact:!0,to:"/browse/"},L.a.createElement("button",null,"New")),L.a.createElement(C.c,{to:"/browse/top/day/"},L.a.createElement("button",null,"Day")),L.a.createElement(C.c,{to:"/browse/top/week/"},L.a.createElement("button",null,"Week")),L.a.createElement(C.c,{to:"/browse/top/month/"},L.a.createElement("button",null,"Month")),L.a.createElement(C.c,{exact:!0,to:"/browse/top/"},L.a.createElement("button",null,"All ")),L.a.createElement("span",{style:{display:"inline-block"}},L.a.createElement("input",{value:n,onChange:function(t){return e.setState({search:t.target.value})},onKeyDown:function(t){return 13==t.keyCode&&e.props.history.push("/browse/search/?title=".concat(n))},placeholder:"search"}),n&&L.a.createElement(C.c,{to:{pathname:"/browse/search/",search:"?title=".concat(n)}},L.a.createElement("button",null,"Search"))),L.a.createElement(Re,{submissions:r,voteFromBrowse:function(t){return e.voteFromBrowse(t)},browseVotes:a,report:function(t){return e.report(t)}}))}}]),n}(L.a.Component),Se=Object(se.e)(_e);function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){T()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k()(e);if(t){var a=k()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return A()(this,n)}}var Ie=0,ke=le()(),Fe=function(e){D()(n,e);var t=Ae(n);function n(){return E()(this,n),t.apply(this,arguments)}return x()(n,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.submissions,r=t.browseVotes;return e.submissions!==n||Object.keys(e.browseVotes).length!==Object.keys(r).length}},{key:"render",value:function(){var e=this.props,t=e.submissions,n=e.voteFromBrowse,r=e.browseVotes,a=e.judge;return t?0==t.length?L.a.createElement("div",{style:{height:"90vh"}},"No actionable reports! Thanks â™¡â™¡â™¡"):L.a.createElement("div",{className:"submissions admin"},t.map((function(e){var t=new Date(e.data.timestamp).toLocaleDateString();return(new Date).getTime()-new Date(e.data.timestamp).getTime()<864e5&&(t=ke.format(e.data.timestamp)),L.a.createElement("div",{key:e.id,className:"submission"},L.a.createElement(C.b,{className:"img-link",to:{pathname:"/",hash:"#".concat(e.id)},onClick:function(){window.UI.setState((function(){return{currentSubmission:null}}),window.UI.load)}},L.a.createElement("img",{src:"".concat("https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F").concat(e.data.id,".png?alt=media")})),L.a.createElement("div",{style:{width:"50%"}},L.a.createElement("h3",{className:"title",style:{flexGrow:1,wordWrap:"break-word"}},L.a.createElement(pe,{text:e.data.title})),L.a.createElement("button",{className:"heart",onClick:function(){return n(e)}},L.a.createElement("h3",null,r[e.id]?"ðŸ–¤":"â™¡",r[e.id]||e.data.score)),L.a.createElement(C.c,{to:{pathname:"/browse/search/",search:"?user=".concat(e.data.user_id)}},"ì›ƒ"),L.a.createElement("h4",null,t),L.a.createElement("h3",{style:{flexGrow:1}},e.data.reports," reports"),L.a.createElement("div",{className:"adminButtons"},L.a.createElement("button",{className:"BAN",title:"ban",onClick:function(){return a(e.id,2)}},"ban ðŸ¤¾ðŸ½â€â™‚ï¸"),L.a.createElement("button",{className:"delete",title:"delete",onClick:function(){return a(e.id,!0)}},"delete ðŸ’¥"),L.a.createElement("button",{className:"pardon",title:"pardon",onClick:function(){return a(e.id,!1)}},"pardon ðŸ£"))))}))):L.a.createElement("div",{style:{height:"90vh"}},"Loading Submissions...")}}]),n}(L.a.Component),Le=function(e){D()(n,e);var t=Ae(n);function n(e){var r;return E()(this,n),(r=t.call(this,e)).state={paused:!1,submissions:null,decidedIds:[],browseVotes:{},search:"",currentUser:firebase.auth().currentUser},r}return x()(n,[{key:"componentWillMount",value:function(){this.loadSubmissions()}},{key:"componentDidUpdate",value:function(e){e.location.pathname!=this.props.location.pathname&&this.loadSubmissions()}},{key:"voteFromBrowse",value:function(e){var t=this;firebase.auth().currentUser.getIdToken().then((function(n){fetch(B._url("api/creations/".concat(e.id,"/vote")),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}}).then((function(e){return e.json()})).then((function(n){t.setState((function(t){var r=t.browseVotes;return{browseVotes:Ue(T()({},e.id,n.score),r)}}))})).catch((function(e){console.error(e)}))}))}},{key:"loadSubmissions",value:function(){var e=this;fetch(B._url("api/reports"),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){e.setState({submissions:t})})).catch((function(t){e.setState({submissions:!1}),console.error("Error:",t)}))}},{key:"judge",value:function(e,t){var n=this;this.setState((function(t){var n=t.decidedIds;return{decidedIds:[].concat(f()(n),[e])}})),firebase.auth().currentUser.getIdToken().then((function(r){fetch(B._url("api/creations/".concat(e,"/judge"))+"?ruling=".concat(t),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){return e.json()})).then((function(e){++Ie>20&&(n.loadSubmissions(),Ie=0)})).catch((function(e){console.error(e)}))}))}},{key:"doSignInWithGoogle",value:function(){var e=new firebase.auth.GoogleAuthProvider;firebase.auth().signInWithRedirect(e)}},{key:"render",value:function(){var e=this,t=this.state,n=t.submissions,r=t.browseVotes,a=(t.currentUser,t.decidedIds);return n=n&&n.filter((function(e){return!a.includes(e.id)})),L.a.createElement(L.a.Fragment,null,L.a.createElement(fe,null),L.a.createElement("h2",{style:{display:"inline-block"}},"do it for doona "),n&&L.a.createElement("h3",null,n.length," actionable reports:"),L.a.createElement(C.c,{to:"/browse/"},L.a.createElement("button",null,"Browse new")),L.a.createElement(Fe,{submissions:n,voteFromBrowse:function(t){return e.voteFromBrowse(t)},browseVotes:r,judge:function(t,n){return e.judge(t,n)}}))}}]),n}(L.a.Component),Ce=Object(se.e)(Le);function Pe(e){e.match;var t=e.location;return L.a.createElement(G,null,L.a.createElement(Se,{location:t}))}function Oe(e){e.match;var t=e.location;return L.a.createElement(G,null,L.a.createElement(Ce,{location:t}))}function Be(e){e.match;var t=e.location;return L.a.createElement(G,null,L.a.createElement(fe,{location:t}))}function Ne(){return L.a.createElement(C.a,null,L.a.createElement(se.a,{path:"/",component:K}),L.a.createElement(se.a,{exact:!0,path:"/info/",component:function(){return L.a.createElement(G,null,L.a.createElement(ue,null))}}),L.a.createElement(se.a,{path:"/browse",component:Pe}),L.a.createElement(se.a,{path:"/admin",component:Oe}),L.a.createElement(se.a,{path:"/login",component:Be}),L.a.createElement(se.a,{path:"/__/auth/handler",component:Be}))}j.a.render(L.a.createElement(Ne,null),document.getElementById("ui"));var Xe=n(79),Me=n(80),ze=n(81),je=n(82),Ge=n(83),Ve=n(84),We=n(85),Ye=n(86),He=n(87),qe=n(88),Ke=n(89),Je=n(90),Qe=n(91);var Ze,$e,et=document.getElementById("fluid-canvas"),tt=document.getElementById("sand-canvas"),nt=[1,1,.8];window.safari&&(history.pushState(null,null,location.href),window.onpopstate=function(e){history.go(1)}),$e=!1,Ze=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(Ze)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Ze.substr(0,4)))&&($e=!0),$e&&(window.onbeforeunload=function(){return!0});var rt=l.b.new(300,300),at=300,it=300,ot=document.getElementById("sand-canvas"),st=document.getElementById("fluid-canvas");ot.height=300*Math.ceil(window.devicePixelRatio),ot.width=300*Math.ceil(window.devicePixelRatio),document.getElementById("background").addEventListener("touchmove",(function(e){window.paused||e.cancelable&&e.preventDefault()}));var ut=document.getElementById("ui"),ct=function(){var e=window.innerWidth,t="",n="";e>window.innerHeight-50?e-window.innerHeight<400?(t="height: ".concat(window.innerHeight,"px; margin:3px"),n="width: ".concat(e-window.innerHeight-12,"px; margin: 2px;")):(t="\n       height: ".concat(window.innerHeight,"px;\n       width:").concat(window.innerHeight,"px;\n       margin:0;\n       left: auto;\n       right: 206px"),n="width: 200px; margin: 2px;","width: ".concat(e-window.innerHeight-356,"px; margin: 1px;")):(t="width: ".concat(e,"px; bottom:3px;"),n=""),ut.style=n,ot.style=t,st.style=t};ct(),window.addEventListener("deviceorientation",ct,!0),window.addEventListener("resize",ct);var lt=function(e){var t=e.universe;et.width=t.width(),et.height=t.height();var n,r={TEXTURE_DOWNSAMPLE:0,DENSITY_DISSIPATION:.98,VELOCITY_DISSIPATION:.99,PRESSURE_DISSIPATION:.8,PRESSURE_ITERATIONS:25,CURL:15,SPLAT_RADIUS:.005},a=[],i=[],o=function(e){var t,n,r={alpha:!1,depth:!1,stencil:!1,antialias:!1,preserveDrawingBuffer:!1},a=e.getContext("webgl2",r),i=!!a;i||(a=e.getContext("webgl",r)||e.getContext("experimental-webgl",r));i?(a.getExtension("EXT_color_buffer_float"),n=a.getExtension("OES_texture_float_linear")):(t=a.getExtension("OES_texture_half_float"),n=a.getExtension("OES_texture_half_float_linear"));a.clearColor(0,0,0,0);var o,s,u,c=i?a.HALF_FLOAT:t.HALF_FLOAT_OES;i?(o=_(a,a.RGBA16F,a.RGBA,c),s=_(a,a.RG16F,a.RG,c),u=_(a,a.R16F,a.RED,c)):(o=_(a,a.RGBA,a.RGBA,c),s=_(a,a.RGBA,a.RGBA,c),u=_(a,a.RGBA,a.RGBA,c));return{gl:a,ext:{formatRGBA:o,formatRG:s,formatR:u,halfFloatTexType:c,supportLinearFiltering:n}}}(et),u=o.gl,c=o.ext,l=function(e){function t(t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw e.getShaderInfoLog(r);return r}return{baseVertexShader:t(e.VERTEX_SHADER,Me),clearShader:t(e.FRAGMENT_SHADER,ze),displayShader:t(e.FRAGMENT_SHADER,je),splatShader:t(e.FRAGMENT_SHADER,Ge),advectionManualFilteringShader:t(e.FRAGMENT_SHADER,Ve),advectionShader:t(e.FRAGMENT_SHADER,We),divergenceShader:t(e.FRAGMENT_SHADER,Ye),curlShader:t(e.FRAGMENT_SHADER,He),vorticityShader:t(e.FRAGMENT_SHADER,qe),pressureShader:t(e.FRAGMENT_SHADER,Ke),gradientSubtractShader:t(e.FRAGMENT_SHADER,Je),velocityOutShader:t(e.FRAGMENT_SHADER,Qe)}}(u),d=l.baseVertexShader,f=l.clearShader,m=l.displayShader,v=l.splatShader,p=l.advectionManualFilteringShader,h=l.advectionShader,g=l.divergenceShader,y=l.curlShader,b=l.vorticityShader,w=l.pressureShader,T=l.gradientSubtractShader,R=l.velocityOutShader;function _(e,t,n,r){if(!function(e,t,n,r){var a=e.createTexture();e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,t,4,4,0,n,r,null);var i=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE}(e,t,n,r))switch(t){case e.R16F:return _(e,e.RG16F,e.RG,r);case e.RG16F:return _(e,e.RGBA16F,e.RGBA,r);default:return null}return{internalFormat:t,format:n}}function S(){this.id=-1,this.x=0,this.y=0,this.dx=0,this.dy=0,this.down=!1,this.moved=!1,this.color=[30,300,30]}(n=new Xe.a({width:300})).add(r,"TEXTURE_DOWNSAMPLE",{Full:0,Half:1,Quarter:2}).name("resolution").onFinishChange(q),n.add(r,"DENSITY_DISSIPATION",.9,1).name("density diffusion"),n.add(r,"VELOCITY_DISSIPATION",.9,1).name("velocity diffusion"),n.add(r,"PRESSURE_DISSIPATION",0,1).name("pressure diffusion"),n.add(r,"PRESSURE_ITERATIONS",1,60).name("iterations"),n.add(r,"CURL",0,50).name("vorticity").step(1),n.add(r,"SPLAT_RADIUS",1e-4,.01).name("splat radius"),n.add({fun:function(){i.push(parseInt(20*Math.random())+5)}},"fun").name("Random splats"),n.close(),a.push(new S);var D,U,A,I,k,F,L,C,P,O,B=function(){function e(t,n){if(E()(this,e),this.uniforms={},this.program=u.createProgram(),u.attachShader(this.program,t),u.attachShader(this.program,n),u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw u.getProgramInfoLog(this.program);for(var r=u.getProgramParameter(this.program,u.ACTIVE_UNIFORMS),a=0;a<r;a++){var i=u.getActiveUniform(this.program,a).name;this.uniforms[i]=u.getUniformLocation(this.program,i)}}return x()(e,[{key:"bind",value:function(){u.useProgram(this.program)}}]),e}();q();var N=new B(d,f),X=new B(d,m),M=new B(d,R),z=new B(d,v),j=new B(d,c.supportLinearFiltering?h:p),G=new B(d,g),V=new B(d,y),W=new B(d,b),Y=new B(d,w),H=new B(d,T);function q(){D=u.drawingBufferWidth>>r.TEXTURE_DOWNSAMPLE,U=u.drawingBufferHeight>>r.TEXTURE_DOWNSAMPLE;var e=c.halfFloatTexType,t=c.formatRGBA,n=c.formatRG,a=c.formatR;I=J(0,D,U,n.internalFormat,n.format,e,c.supportLinearFiltering?u.LINEAR:u.NEAREST),A=J(2,D,U,t.internalFormat,t.format,e,c.supportLinearFiltering?u.LINEAR:u.NEAREST),C=K(4,D,U,a.internalFormat,a.format,e,u.NEAREST),P=K(5,D,U,a.internalFormat,a.format,e,u.NEAREST),O=J(6,D,U,a.internalFormat,a.format,e,u.NEAREST),F=K(8,D,U,n.internalFormat,n.format,e,c.supportLinearFiltering?u.LINEAR:u.NEAREST),L=K(10,D,U,n.internalFormat,n.format,e,c.supportLinearFiltering?u.LINEAR:u.NEAREST),k=K(9,D,U,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,c.supportLinearFiltering?u.LINEAR:u.NEAREST)}function K(e,t,n,r,a,i,o){u.activeTexture(u.TEXTURE0+e);var s=u.createTexture();u.bindTexture(u.TEXTURE_2D,s),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,o),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,o),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texImage2D(u.TEXTURE_2D,0,r,t,n,0,a,i,null);var c=u.createFramebuffer();return u.bindFramebuffer(u.FRAMEBUFFER,c),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),u.viewport(0,0,t,n),u.clear(u.COLOR_BUFFER_BIT),[s,c,e]}function J(e,t,n,r,a,i,o){var s=K(e,t,n,r,a,i,o),u=K(e+1,t,n,r,a,i,o);return{get read(){return s},get write(){return u},swap:function(){var e=s;s=u,u=e}}}var Q,Z,$,ee=(u.bindBuffer(u.ARRAY_BUFFER,u.createBuffer()),u.bufferData(u.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,u.createBuffer()),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),u.STATIC_DRAW),u.vertexAttribPointer(0,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(0),function(e){u.bindFramebuffer(u.FRAMEBUFFER,e),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0)}),te=Date.now(),ne=t.width(),re=t.height(),ae=new Uint8Array(s.d.buffer,t.winds(),ne*re*4),ie=new Uint8Array(s.d.buffer,t.burns(),ne*re*4),oe=new Uint8Array(s.d.buffer,t.cells(),ne*re*4);function se(e,t,n,r,a){z.bind();var i=0;u.activeTexture(u.TEXTURE0+i),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(z.uniforms.uTarget,i++),u.uniform1f(z.uniforms.aspectRatio,et.width/et.height),u.uniform2f(z.uniforms.point,t/et.height,e/et.width),u.uniform3f(z.uniforms.color,r,n,1),u.uniform1f(z.uniforms.radius,(window.UI.state.size+1)/600),ee(I.write[1]),I.swap(),u.activeTexture(u.TEXTURE0+i),u.bindTexture(u.TEXTURE_2D,A.read[0]),u.uniform1i(z.uniforms.uTarget,i++),u.uniform3f(z.uniforms.color,a[0],a[1],a[2]),ee(A.write[1]),A.swap()}var ue=function(){Q=tt.getBoundingClientRect(),Z=tt.width/Math.ceil(window.devicePixelRatio)/Q.width,$=tt.height/Math.ceil(window.devicePixelRatio)/Q.height};return ue(),window.addEventListener("resize",ue),window.addEventListener("deviceorientation",ue,!0),tt.addEventListener("mousemove",(function(e){var t=(e.clientX-Q.left)*Z,n=(e.clientY-Q.top)*$;a[0].moved=a[0].down,a[0].dx=10*(t-a[0].x),a[0].dy=10*(n-a[0].y),a[0].x=t,a[0].y=n})),tt.addEventListener("touchmove",(function(e){window.paused||e.cancelable&&e.preventDefault();for(var t=e.targetTouches,n=0;n<t.length;n++){var r=a[n];r.moved=r.down;var i=(t[n].clientX-Q.left)*Z,o=(t[n].clientY-Q.top)*$;r.dx=10*(i-r.x),r.dy=10*(o-r.y),r.x=i,r.y=o}}),!1),tt.addEventListener("mousedown",(function(){a[0].down=!0,a[0].color=nt})),tt.addEventListener("touchstart",(function(e){e.cancelable&&e.preventDefault();for(var t=e.targetTouches,n=0;n<t.length;n++){n>=a.length&&a.push(new S);var r=(t[n].clientX-Q.left)*Z,i=(t[n].clientY-Q.top)*$;a[n].id=t[n].identifier,a[n].down=!0,a[n].x=r,a[n].y=i,a[n].color=nt}})),window.addEventListener("mouseup",(function(){a[0].down=!1})),window.addEventListener("touchend",(function(e){for(var t=e.changedTouches,n=0;n<t.length;n++)for(var r=0;r<a.length;r++)t[n].identifier==a[r].id&&(a[r].down=!1)})),{update:function(){ae=new Uint8Array(s.d.buffer,t.winds(),ne*re*4),ie=new Uint8Array(s.d.buffer,t.burns(),ne*re*4);var e=t.cells();oe=new Uint8Array(s.d.buffer,e,ne*re*4);var n=Math.min((Date.now()-te)/1e3,.016);te=Date.now(),u.viewport(0,0,D,U),i.length>0&&function(e){for(var t=0;t<e;t++){var n=nt,r=et.width*Math.random(),a=et.height*Math.random(),i=1e3*(Math.random()-.5),o=1e3*(Math.random()-.5);se(r,a,i,o,n)}}(i),j.bind();var o,c=0;u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(j.uniforms.uVelocity,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(j.uniforms.uSource,c++),u.uniform2f(j.uniforms.texelSize,1/D,1/U),u.uniform1f(j.uniforms.dt,n),u.uniform1f(j.uniforms.dissipation,r.VELOCITY_DISSIPATION),ee(I.write[1]),I.swap(),u.bindTexture(u.TEXTURE_2D,F[0]),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,ne,re,0,u.RGBA,u.UNSIGNED_BYTE,ie),u.bindTexture(u.TEXTURE_2D,L[0]),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,ne,re,0,u.RGBA,u.UNSIGNED_BYTE,oe),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,F[0]),u.uniform1i(j.uniforms.uWind,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(j.uniforms.uVelocity,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,A.read[0]),u.uniform1i(j.uniforms.uSource,c++),u.uniform1f(j.uniforms.dissipation,r.DENSITY_DISSIPATION),ee(A.write[1]),A.swap();for(var l=0;l<a.length;l++){var d=a[l];d.moved&&window.UI.state.selectedElement<0&&(se(d.x,d.y,d.dx,d.dy,d.color),d.moved=!1)}V.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(V.uniforms.uVelocity,c++),u.uniform2f(V.uniforms.texelSize,1/D,1/U),ee(P[1]),W.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(W.uniforms.uVelocity,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,P[0]),u.uniform1i(W.uniforms.uCurl,c++),u.uniform2f(W.uniforms.texelSize,1/D,1/U),u.uniform1f(W.uniforms.curl,r.CURL),u.uniform1f(W.uniforms.dt,n),ee(I.write[1]),I.swap(),G.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(G.uniforms.uVelocity,c++),u.uniform2f(G.uniforms.texelSize,1/D,1/U),ee(C[1]),N.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,F[0]),u.uniform1i(N.uniforms.uWind,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,O.read[0]),u.uniform1i(N.uniforms.uTexture,c++),u.uniform1f(N.uniforms.value,r.PRESSURE_DISSIPATION),ee(O.write[1]),O.swap(),Y.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,C[0]),u.uniform1i(Y.uniforms.uDivergence,c++),u.uniform2f(Y.uniforms.texelSize,1/D,1/U),o=O.read[2],u.uniform1i(Y.uniforms.uPressure,o),u.activeTexture(u.TEXTURE0+o);for(var f=0;f<r.PRESSURE_ITERATIONS;f++)u.bindTexture(u.TEXTURE_2D,O.read[0]),ee(O.write[1]),O.swap();M.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(M.uniforms.uTexture,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,O.read[0]),u.uniform1i(M.uniforms.uPressure,c++),ee(k[1]),u.readPixels(0,0,ne,re,u.RGBA,u.UNSIGNED_BYTE,ae),H.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,F[0]),u.uniform1i(H.uniforms.uWind,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,O.read[0]),u.uniform1i(H.uniforms.uPressure,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(H.uniforms.uVelocity,c++),u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,L[0]),u.uniform1i(H.uniforms.uCells,c++),u.uniform2f(H.uniforms.texelSize,1/D,1/U),ee(I.write[1]),I.swap(),u.viewport(0,0,u.drawingBufferWidth,u.drawingBufferHeight),X.bind(),c=0,u.activeTexture(u.TEXTURE0+c),u.bindTexture(u.TEXTURE_2D,A.read[0]),u.uniform1i(X.uniforms.uTexture,c++),ee(null)},reset:function(){N.bind();var e=0;u.activeTexture(u.TEXTURE0+e),u.bindTexture(u.TEXTURE_2D,F[0]),u.uniform1i(N.uniforms.uWind,e++),u.activeTexture(u.TEXTURE0+e),u.bindTexture(u.TEXTURE_2D,A.read[0]),u.uniform1i(N.uniforms.uTexture,e++),u.uniform1f(N.uniforms.value,0),ee(A.write[1]),A.swap(),e=0,u.activeTexture(u.TEXTURE0+e),u.bindTexture(u.TEXTURE_2D,F[0]),u.uniform1i(N.uniforms.uWind,e++),u.activeTexture(u.TEXTURE0+e),u.bindTexture(u.TEXTURE_2D,O.read[0]),u.uniform1i(N.uniforms.uTexture,e++),u.uniform1f(N.uniforms.value,0),ee(O.write[1]),O.swap(),e=0,u.activeTexture(u.TEXTURE0+e),u.bindTexture(u.TEXTURE_2D,F[0]),u.uniform1i(N.uniforms.uWind,e++),u.activeTexture(u.TEXTURE0+e),u.bindTexture(u.TEXTURE_2D,I.read[0]),u.uniform1i(N.uniforms.uTexture,e++),u.uniform1f(N.uniforms.value,0),ee(I.write[1]),I.swap()}}}({universe:rt}),dt=h({canvas:ot,universe:rt});function ft(){lt.reset(),lt.update(),lt.reset(),lt.update(),rt.reset()}!function e(){window.paused||(b.render(),rt.tick(),lt.update()),dt(),window.animationId=requestAnimationFrame(e)}(),window.u=rt,function(e,t){c.apply(this,arguments)}(at,it),document.addEventListener("keydown",(function(e){e.ctrlKey&&"z"===e.key&&(ft(),rt.pop_undo())}))},23:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return v}));var r=n(8);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var s=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();var u=null;function c(e,t){return s.decode((null!==u&&u.buffer===r.d.buffer||(u=new Uint8Array(r.d.buffer)),u).subarray(e,e+t))}var l,d=Object.freeze({Empty:0,0:"Empty",Wall:1,1:"Wall",Sand:2,2:"Sand",Water:3,3:"Water",Stone:13,13:"Stone",Ice:9,9:"Ice",Gas:4,4:"Gas",Cloner:5,5:"Cloner",Mite:15,15:"Mite",Wood:7,7:"Wood",Plant:11,11:"Plant",Fungus:18,18:"Fungus",Seed:19,19:"Seed",Fire:6,6:"Fire",Lava:8,8:"Lava",Acid:12,12:"Acid",Dust:14,14:"Dust",Oil:16,16:"Oil",Rocket:17,17:"Rocket"}),f=function(){function e(){a(this,e)}return o(e,[{key:"__destroy_into_raw",value:function(){var e=this.ptr;return this.ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();r.b(e)}},{key:"reset",value:function(){r.m(this.ptr)}},{key:"tick",value:function(){r.n(this.ptr)}},{key:"width",value:function(){return r.o(this.ptr)}},{key:"height",value:function(){return r.h(this.ptr)}},{key:"cells",value:function(){return r.f(this.ptr)}},{key:"winds",value:function(){return r.p(this.ptr)}},{key:"burns",value:function(){return r.e(this.ptr)}},{key:"paint",value:function(e,t,n,a){r.j(this.ptr,e,t,n,a)}},{key:"push_undo",value:function(){r.l(this.ptr)}},{key:"pop_undo",value:function(){r.k(this.ptr)}},{key:"flush_undos",value:function(){r.g(this.ptr)}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}},{key:"new",value:function(t,n){var a=r.i(t,n);return e.__wrap(a)}}]),e}(),m="function"==typeof Math.random?Math.random:(l="Math.random",function(){throw new Error("".concat(l," is not defined"))});function v(e,t){throw new Error(c(e,t))}}).call(this,n(39)(e))},44:function(e,t){e.exports="precision highp float;\n#define GLSLIFY 1\nuniform float t;\nuniform float dpi;\nuniform vec2 resolution;\nuniform bool isSnapshot;\nuniform sampler2D backBuffer;\nuniform sampler2D data;\n\nvarying vec2 uv;\n\n// clang-format off\nvec3 hsv2rgb_3_0(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_1_1(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289_1_1(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_1_2(vec4 x) {\n     return mod289_1_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_1_3(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise_1_4(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D_1_5 = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_1_6 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_1_6;\n  vec3 i1 = min( g_1_6.xyz, l.zxy );\n  vec3 i2 = max( g_1_6.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D_1_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289_1_1(i);\n  vec4 p = permute_1_2( permute_1_2( permute_1_2(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D_1_5.wyz - D_1_5.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1_1_7 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0_1_8 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1_1_7.xy,h.z);\n  vec3 p3 = vec3(a1_1_7.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt_1_3(vec4(dot(p0_1_8,p0_1_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0_1_8 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0_1_8,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n\n\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_2_9(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289_2_9(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute_2_10(vec3 x) {\n  return mod289_2_9(((x*34.0)+1.0)*x);\n}\n\nfloat snoise_2_11(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289_2_9(i); // Avoid truncation effects in permutation\n  vec3 p = permute_2_10( permute_2_10( i.y + vec3(0.0, i1.y, 1.0 ))\n    + i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\n\n\nhighp float random_4_12(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\n\n\n// clang-format on\n\nvoid main() {\n  vec3 color;\n  //   float r = abs(sin(t / 25.));\n  //   if (length(uv) < r && length(uv) > r - 0.1) {\n  // color = hsv2rgb(vec3(sin(t * 0.01), 0.5, 0.5));\n\n  vec2 textCoord = ((uv * vec2(0.5, -0.5)) + vec2(0.5)).yx;\n  // vec3 bb = texture2D(backBuffer, (uv * 0.5) + vec2(0.5)).rgb;\n\n  vec4 data = texture2D(data, textCoord);\n  int type = int((data.r * 255.) + 0.1);\n  float hue = 0.0;\n  float saturation = 0.6;\n  float lightness = 0.3 + data.g * 0.5;\n  float noise = snoise_1_4(vec3(floor(uv * resolution / dpi), t * 0.05));\n  float a = 1.0;\n\n  if (type == 0) {\n    hue = 0.0;\n    saturation = 0.1;\n    lightness = 0.1;\n    a = 0.1;\n    if (isSnapshot) {\n      saturation = 0.05;\n      lightness = 1.01;\n      a = 1.0;\n    }\n  } else if (type == 1) {\n    hue = 0.1;\n    saturation = 0.1;\n    lightness = 0.4;\n  } else if (type == 2) {\n    hue = 0.1;\n    saturation = 0.5;\n    lightness += 0.3;\n  } else if (type == 3) { // water\n    hue = 0.6;\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\n  } else if (type == 4) { // gas\n    hue = 0.0;\n    lightness += 0.4;\n    saturation = 0.2 + (data.b * 1.5);\n  } else if (type == 5) { // clone\n    hue = 0.9;\n    saturation = 0.3;\n  } else if (type == 6) { // fire\n    hue = (data.g * 0.1);\n    saturation = 0.7;\n\n    lightness = 0.7 + (data.g * 0.3) + ((noise + 0.8) * 0.5);\n  } else if (type == 7) { // wood\n    hue = (data.g * 0.1);\n    saturation = 0.3;\n    lightness = 0.3 + data.g * 0.3;\n  } else if (type == 8) { // lava\n    hue = (data.g * 0.1);\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\n  } else if (type == 9) { // ice\n    hue = 0.6;\n    saturation = 0.4;\n    lightness = 0.7 + data.g * 0.5;\n  } else if (type == 10) { // sink\n    hue = 0.9;\n    saturation = 0.4;\n    lightness = 1.0;\n  } else if (type == 11) { // plant\n    hue = 0.4;\n    saturation = 0.4;\n  } else if (type == 12) { // acid\n    hue = 0.18;\n    saturation = 0.9;\n    lightness = 0.8 + data.g * 0.2 + noise * 0.05;\n  } else if (type == 13) { // stone\n    hue = -0.4 + (data.g * 0.5);\n    saturation = 0.1;\n    // lightness = 0.2 + data.g * 0.5;\n  } else if (type == 14) { // dust\n    hue = (data.g * 2.0) + t * .0008;\n    saturation = 0.4;\n    lightness = 0.8;\n  } else if (type == 15) { // mite\n    hue = 0.8;\n    saturation = 0.9;\n    lightness = 0.8;\n  } else if (type == 16) { // oil\n    hue = (data.g * 5.0) + t * .008;\n\n    saturation = 0.2;\n    lightness = 0.3;\n  } else if (type == 17) { // Rocket\n    hue = 0.0;\n    saturation = 0.4 + data.b;\n    lightness = 0.9;\n  } else if (type == 18) { // fungus\n    hue = (data.g * 0.15) - 0.1;\n    saturation = (data.g * 0.8) - 0.05;\n\n    // (data.g * 0.00);\n    lightness = 1.5 - (data.g * 0.2);\n  } else if (type == 19) { // seed/flower\n\n    hue = fract(fract(data.b * 2.) * 0.5) - 0.3;\n    saturation = 0.7 * (data.g + 0.4) + data.b * 0.2;\n    lightness = 0.9 * (data.g + 0.9);\n  }\n  if (isSnapshot == false) {\n    lightness *= (0.975 + snoise_2_11(floor(uv * resolution / dpi)) * 0.025);\n  }\n  color = hsv2rgb_3_0(vec3(hue, saturation, lightness));\n  gl_FragColor = vec4(color, a);\n}"},45:function(e,t){e.exports='\n// boring "pass-through" vertex shader\nprecision mediump float;\n#define GLSLIFY 1\nattribute vec2 position;\nvarying vec2 uv;\nvoid main() {\n  uv = position;\n  gl_Position = vec4(position, 0, 1);\n}'},8:function(e,t,n){"use strict";var r=n.w[e.i];e.exports=r;n(23);r.q()},80:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nattribute vec2 aPosition;\nvarying vec2 vUv;\nvarying vec2 vL;\nvarying vec2 vR;\nvarying vec2 vT;\nvarying vec2 vB;\nuniform vec2 texelSize;\nvoid main() {\n  vUv = aPosition * 0.5 + 0.5;\n  vL = vUv - vec2(texelSize.x, 0.0);\n  vR = vUv + vec2(texelSize.x, 0.0);\n  vT = vUv + vec2(0.0, texelSize.y);\n  vB = vUv - vec2(0.0, texelSize.y);\n  gl_Position = vec4(aPosition, 0.0, 1.0);\n}\n"},81:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D uTexture;\nuniform sampler2D uWind;\nuniform float value;\nvoid main() {\n  float pressure = texture2D(uWind, vUv).z;\n  pressure *= 512.;\n  pressure *= pressure;\n  gl_FragColor = value * (texture2D(uTexture, vUv) + vec4(pressure));\n}"},82:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D uTexture;\nvoid main() {\n  vec3 color = texture2D(uTexture, vec2(1.0 - vUv.y,vUv.x)).rgb * 0.1;\n  color *= 0.5;\n  color = min(color, 0.9);\n  color = vec3(1.0) - color;\n  color *= vec3(0.95, 0.9, 0.9);\n  // color *= 0.5;\n  gl_FragColor = vec4(color, 1.0);\n}\n"},83:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D uTarget;\nuniform float aspectRatio;\nuniform vec3 color;\nuniform vec2 point;\nuniform float radius;\nvoid main() {\n  vec2 p = vUv - point.xy;\n  p.x *= aspectRatio;\n  vec3 splat = exp(-dot(p, p) / radius) * color;\n  vec3 base = texture2D(uTarget, vUv).xyz;\n  gl_FragColor = vec4(base + splat, 1.0);\n}"},84:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D uVelocity;\nuniform sampler2D uSource;\nuniform sampler2D uWind;\nuniform vec2 texelSize;\nuniform float dt;\nuniform float dissipation;\nvec4 bilerp(in sampler2D sam, in vec2 p) {\n  vec4 st;\n  st.xy = floor(p - 0.5) + 0.5;\n  st.zw = st.xy + 1.0;\n  vec4 uv = st * texelSize.xyxy;\n  vec4 a = texture2D(sam, uv.xy);\n  vec4 b = texture2D(sam, uv.zy);\n  vec4 c = texture2D(sam, uv.xw);\n  vec4 d = texture2D(sam, uv.zw);\n  vec2 f = p - st.xy;\n  return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);\n}\nvoid main() {\n  vec2 coord = gl_FragCoord.xy - dt * texture2D(uVelocity, vUv).xy;\n  float density = texture2D(uWind, vUv).w;\n  if (density > 0.99) {\n    density = 0.;\n  }\n  gl_FragColor = dissipation * (bilerp(uSource, coord) + vec4(density));\n  gl_FragColor.a = 1.0;\n}"},85:function(e,t){e.exports="\nprecision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D uVelocity;\nuniform sampler2D uSource;\nuniform sampler2D uWind;\nuniform vec2 texelSize;\nuniform float dt;\nuniform float dissipation;\nvoid main() {\n  vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\n  float density = texture2D(uWind, vUv).w * 1.;\n  if (density > 0.99) {\n    density = 0.;\n  }\n\n  gl_FragColor = dissipation * (texture2D(uSource, coord) + vec4(density));\n  gl_FragColor.a = 1.0;\n}\n"},86:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vL;\nvarying vec2 vR;\nvarying vec2 vT;\nvarying vec2 vB;\nuniform sampler2D uVelocity;\nvec2 sampleVelocity(in vec2 uv) {\n  vec2 multiplier = vec2(1.0, 1.0);\n  if (uv.x < 0.0) {\n    uv.x = 0.0;\n    multiplier.x = -1.0;\n  }\n  if (uv.x > 1.0) {\n    uv.x = 1.0;\n    multiplier.x = -1.0;\n  }\n  if (uv.y < 0.0) {\n    uv.y = 0.0;\n    multiplier.y = -1.0;\n  }\n  if (uv.y > 1.0) {\n    uv.y = 1.0;\n    multiplier.y = -1.0;\n  }\n  return multiplier * texture2D(uVelocity, uv).xy;\n}\nvoid main() {\n  float L = sampleVelocity(vL).x;\n  float R = sampleVelocity(vR).x;\n  float T = sampleVelocity(vT).y;\n  float B = sampleVelocity(vB).y;\n  float div = 0.5 * (R - L + T - B);\n  gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\n}\n"},87:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vL;\nvarying vec2 vR;\nvarying vec2 vT;\nvarying vec2 vB;\nuniform sampler2D uVelocity;\nvoid main() {\n  float L = texture2D(uVelocity, vL).y;\n  float R = texture2D(uVelocity, vR).y;\n  float T = texture2D(uVelocity, vT).x;\n  float B = texture2D(uVelocity, vB).x;\n  float vorticity = R - L - T + B;\n  gl_FragColor = vec4(vorticity, 0.0, 0.0, 1.0);\n}"},88:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vT;\nvarying vec2 vB;\nuniform sampler2D uVelocity;\nuniform sampler2D uCurl;\nuniform float curl;\nuniform float dt;\nvoid main() {\n  float T = texture2D(uCurl, vT).x;\n  float B = texture2D(uCurl, vB).x;\n  float C = texture2D(uCurl, vUv).x;\n  vec2 force = vec2(abs(T) - abs(B), 0.0);\n  force *= 1.0 / length(force + 0.00001) * curl * C;\n  vec2 vel = texture2D(uVelocity, vUv).xy;\n  gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\n}"},89:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vL;\nvarying vec2 vR;\nvarying vec2 vT;\nvarying vec2 vB;\nuniform sampler2D uPressure;\nuniform sampler2D uDivergence;\nvec2 boundary(in vec2 uv) {\n  uv = min(max(uv, 0.0), 1.0);\n  return uv;\n}\nvoid main() {\n  float L = texture2D(uPressure, boundary(vL)).x;\n  float R = texture2D(uPressure, boundary(vR)).x;\n  float T = texture2D(uPressure, boundary(vT)).x;\n  float B = texture2D(uPressure, boundary(vB)).x;\n  float C = texture2D(uPressure, vUv).x;\n  float divergence = texture2D(uDivergence, vUv).x;\n  float pressure = (L + R + B + T - divergence) * 0.25;\n  gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\n}"},90:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec2 vL;\nvarying vec2 vR;\nvarying vec2 vT;\nvarying vec2 vB;\nuniform sampler2D uPressure;\nuniform sampler2D uVelocity;\nuniform sampler2D uWind;\nuniform sampler2D uCells;\n\nvec2 boundary(in vec2 uv) {\n  uv = min(max(uv, 0.0), 1.0);\n  return uv;\n}\nvoid main() {\n  float L = texture2D(uPressure, boundary(vL)).x;\n  float R = texture2D(uPressure, boundary(vR)).x;\n  float T = texture2D(uPressure, boundary(vT)).x;\n  float B = texture2D(uPressure, boundary(vB)).x;\n  vec2 velocity = texture2D(uVelocity, vUv).xy;\n  vec2 wind = texture2D(uWind, vUv).xy;\n  vec2 cell = texture2D(uCells, vUv).xy;\n  velocity.xy -= vec2(R - L, T - B);\n  velocity.yx += wind * -25.; // hack, probably wrong for X\n\n  int type = int((cell.r * 255.) + 0.1);\n\n  // || type == 7 || type == 9\n  if (type == 1 || type == 5) {\n    velocity = vec2(0.);\n  }\n  if (type == 0 || type == 4 || type == 6) {\n\n  } else {\n    velocity = velocity * 0.95;\n  }\n  // velocity = cell.rg * 100.;\n  gl_FragColor = vec4(velocity, 0.0, 1.0);\n}"},91:function(e,t){e.exports="precision highp float;\nprecision mediump sampler2D;\n#define GLSLIFY 1\nvarying vec2 vUv;\nuniform sampler2D uTexture;\nuniform sampler2D uPressure;\nvoid main() {\n  vec2 v = texture2D(uTexture, vUv).rg;\n  float p = texture2D(uPressure, vUv).r;\n  vec3 vp = vec3(v, p);\n  vp = max(vp, vec3(-250.));\n  vp = min(vp, vec3(250.));\n  vp /= 500.;\n  vp += vec3(0.5, 0.5, 0.);\n  // v = vec2(0.5);\n  gl_FragColor = vec4(vp, 0.0);\n}\n"}}]);
//# sourceMappingURL=2.ad246f4856cd6a79a015.js.map